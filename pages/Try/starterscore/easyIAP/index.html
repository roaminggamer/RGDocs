<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="canonical" href="https://roaminggamer.github.io/RGDocs/pages/Try/starterscore/easyIAP/"> 
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Easy IAP - Starters Core</title>

    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">Starters Core</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">About</a>
                    </li>
                
                
                
                    <li >
                        <a href="../buttonMaker/">Button Maker</a>
                    </li>
                
                
                
                    <li >
                        <a href="../easyAds/">Easy Ads</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Easy IAP</a>
                    </li>
                
                
                
                    <li >
                        <a href="../frameworks/">Frameworks</a>
                    </li>
                
                
                
                    <li >
                        <a href="../ssk2/">SSK2</a>
                    </li>
                
                
                
                    <li >
                        <a href="../rgdocs/">RG Docs</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../easyAds/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../frameworks/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#easy-in-app-purchases">Easy In App Purchases</a></li>
        
    
        <li class="first-level "><a href="#project-settings">Project Settings</a></li>
        
    
        <li class="first-level "><a href="#basic-usage">Basic Usage</a></li>
        
            <li class="third-level"><a href="#step-1-require-once-as-global">Step 1 - Require Once As Global</a></li>
        
            <li class="third-level"><a href="#step-2-get-iap-ids">Step 2 - Get IAP IDs</a></li>
        
            <li class="third-level"><a href="#step-3-add-items">Step 3 - Add Item(s)</a></li>
        
            <li class="third-level"><a href="#step-4-initialize-easy-ads">Step 4 - Initialize Easy Ads</a></li>
        
    
        <li class="first-level "><a href="#automatically-generated-functions">Automatically Generated Functions</a></li>
        
    
        <li class="first-level "><a href="#restoring">Restoring</a></li>
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="easy-in-app-purchases">Easy In App Purchases</h1>
<p>The <code>Starters Core</code> kit comes with the <code>Easy IAP</code> module.  It is a layer on top of <a href="https://github.com/happymongoose/iap_badger">IAP Badger</a> to make it even easier to set up In App Purchases.</p>
<h1 id="project-settings">Project Settings</h1>
<p>Please see the Corona docs for setting up the config.lua and build.settings files.</p>
<ul>
<li><a href="https://docs.coronalabs.com/plugin/google-iap-v3/index.html">Google IAP</a></li>
</ul>
<hr />
<h1 id="basic-usage">Basic Usage</h1>
<h2 id="step-1-require-once-as-global">Step 1 - Require Once As Global</h2>
<p>To simplify using the module, just require it once as a global.</p>
<pre><code class="Lua">_G.easyIAP = require &quot;easy.iap.easyIAP&quot;
</code></pre>

<p>Now, it is available for use everywhere you might want it.</p>
<h2 id="step-2-get-iap-ids">Step 2 - Get IAP IDs</h2>
<p>Acquire IDs for all IAP items you intend to sell from the Apple and/or Google Play console.</p>
<p>How to do this is outside the scope of these docs and you are assumed to know how to do this already.</p>
<h2 id="step-3-add-items">Step 3 - Add Item(s)</h2>
<h3 id="example-1-no-ads-non-consumable">Example 1 - No Ads Non-Consumable</h3>
<pre><code class="Lua">local ids = { android = {}, ios = {} }
ids.android.noads       = &quot;com.yourcompany.appname.noads&quot;

ids.ios.noads           = &quot;com.yourcompany.appname.noads&quot;

local os = utils.os()

if( os == &quot;android&quot; or os == &quot;ios&quot; ) then
   easyIAP.addItem( &quot;noads&quot;, ids[os].noads, &quot;non-consumable&quot;  )
end
</code></pre>

<blockquote>
<blockquote>
<p><strong>Tip:</strong> Use all lower case for ids when you make them and use all lowercase for item names when you add them.  This ensures you don't make errors later.</p>
</blockquote>
</blockquote>
<p>Once this step is complete and once you have initilized the module, two new functions will automatically be available for use:</p>
<pre><code class="Lua">easyIAP.buy_noads()  - You can call this to buy the 'noads' IAP.
easyIAP.owns_noads() - You can call thos to see if you own the 'noads' IAP.
</code></pre>

<h3 id="example-2-consumable-coin-packs">Example 2 - Consumable Coin Packs</h3>
<pre><code class="Lua">local ids = { android = {}, ios = {} }
ids.android.coins100   = &quot;com.yourcompany.appname.coins100&quot;
ids.android.coins1000  = &quot;com.yourcompany.appname.coins1000&quot;
ids.android.coins5000  = &quot;com.yourcompany.appname.coins5000&quot;

ids.ios.coins100       = &quot;com.yourcompany.appname.coins100&quot;
ids.ios.coins1000      = &quot;com.yourcompany.appname.coins1000&quot;
ids.ios.coins5000      = &quot;com.yourcompany.appname.coins5000&quot;

local os = utils.os()

if( os == &quot;android&quot; or os == &quot;ios&quot; ) then
   easyIAP.addItem( &quot;coins100&quot;, ids[os].coins100, &quot;consumable&quot;  )
   easyIAP.addItem( &quot;coins1000&quot;, ids[os].coins1000, &quot;consumable&quot;  )
   easyIAP.addItem( &quot;coins5000&quot;, ids[os].coins5000, &quot;consumable&quot;  )
end
</code></pre>

<blockquote>
<blockquote>
<p><strong>Tip:</strong> Use all lower case for ids when you make them and use all lowercase for item names when you add them.  This ensures you don't make errors later.</p>
</blockquote>
</blockquote>
<p>Once this step is complete and once you have initilized the module, six new functions will automatically be available for use:</p>
<pre><code class="Lua">
-- Buy the items.
easyIAP.buy_coins100()
easyIAP.buy_coins1000()
easyIAP.buy_coins5000()

-- 
easyIAP.owns_coins100()
easyIAP.owns_coins1000()
easyIAP.owns_coins5000()
</code></pre>

<h2 id="step-4-initialize-easy-ads">Step 4 - Initialize Easy Ads</h2>
<pre><code class="Lua">easyIAP.init( 
   {
      salt               = &quot;TypeSomeRandomStringHere&quot;,
      testMode           = true,
      doNotLoadInventory = false,
   } )
</code></pre>

<p>In this example, we passed three arguments:</p>
<ul>
<li><code>salt</code> - Used by IAP badger to encrypt your IAP.json settomgs storage file.</li>
<li><code>testMode</code> - A boolean that determines if we are running in test mode or production mode.</li>
<li><code>doNotLoadInventory</code> - If you set this to <code>true</code>, the catalog is not reloaded next time the apps restarts.  i.e. it is as if you did not purchase any non-consumable items.</li>
</ul>
<p>Additional arguments you may want to use/pass are:</p>
<ul>
<li><code>iapFilename</code> (<code>iap.json</code>) - You can provide an alternate name for the settings file.</li>
<li><code>onFail</code> - A reference to a common 'failed' listener.  This is not required but may be convenient if you like to have all your code in one place.</li>
<li><code>onCancel</code> - A reference to a common 'cancelled' listener.  This is not required but may be convenient if you like to have all your code in one place.</li>
</ul>
<p>Lastly, the <code>init()</code> function takes a second argument: <code>onCatalog</code> which references an optional listener.  If you provide this argument, IAP badger will query the store and some time later return a table of all known products, names, their IDs, and their localized prices.  This information will be passed into the listener as a table.</p>
<pre><code class="Lua">local function onCatalog( catalog )
   utils.print_r( catalog )
end

easyIAP.init( 
   {
      salt               = &quot;TypeSomeRandomStringHere&quot;,
      testMode           = true,
      doNotLoadInventory = false,
   }, onCatalog )
</code></pre>

<h1 id="automatically-generated-functions">Automatically Generated Functions</h1>
<p>As was mentioned above when describing 'adding items', adding a named item automatically creates two functions on the <code>easyAds</code> module.</p>
<blockquote>
<blockquote>
<p><code>easyAds.addItem( &lt;name&gt;, storeIAPID )</code>
generates,</p>
</blockquote>
</blockquote>
<ul>
<li><code>easyAds.buy_&lt;name&gt;( onSuccess )</code> - Calling this will attempt to buy the product.<ul>
<li><code>onSuccess</code> is a function that will be called when the purchase attempt completes successfully.</li>
</ul>
</li>
<li><code>easyAds.owns_&lt;name&gt;()</code>  - When called, this will return <code>true</code> if the item is a non-consumable and the user has purchased it.</li>
</ul>
<h1 id="restoring">Restoring</h1>
<p>Finally, any time after initializing, you can attempto to restore all non-consumable items by calling:</p>
<ul>
<li><code>easyAds.restore( [ onSuccess [ , onFailure ] ] )</code> <ul>
<li><code>onSuccess</code> is an optional function that will be called when the restore attempt completes successfully.</li>
<li><code>onFailure</code> is an optional function that will be called when the restore attempt completes unsuccessfully.</li>
</ul>
</li>
</ul>
<hr />
<p><img alt="RoamingGamer" src="../images/roaming_gamer_small.png" />  Copyright &copy; Roaming Gamer, LLC. 2008-2018; All Rights Reserved </p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '..';
    </script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
